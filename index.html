<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OneDocs</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Lato:wght@400;700&family=Montserrat:wght@400;700&family=Open+Sans:wght@400;700&family=Oswald:wght@400;700&family=Roboto:wght@400;700&family=Source+Sans+Pro:wght@400;700&display=swap" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script src="https://unpkg.com/html-docx-js/dist/html-docx.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>

    <style>
        body { margin: 0; padding: 0; overflow: hidden; font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        
        @media print {
            body { background: white; height: auto; overflow: visible; }
            .no-print { display: none !important; }
            .print-container { margin: 0; padding: 0; box-shadow: none; border: none; width: 100%; transform: none !important; }
        }

        .scrollbar-thin::-webkit-scrollbar { width: 8px; height: 8px; }
        .scrollbar-thin::-webkit-scrollbar-track { background: transparent; }
        .scrollbar-thin::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        .scrollbar-thin::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .animate-fade-in { animation: fadeIn 0.3s ease-out; }
        
        @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-slide-up { animation: slideUp 0.4s ease-out forwards; }

        @keyframes shimmer {
            0% { background-position: -200% center; }
            100% { background-position: 200% center; }
        }
        .logo-shimmer {
            background: linear-gradient(to right, #2563eb 20%, #9333ea 40%, #ec4899 60%, #2563eb 80%);
            background-size: 200% auto;
            color: transparent;
            -webkit-background-clip: text;
            background-clip: text;
            animation: shimmer 5s linear infinite;
        }

        .editor-page {
            color: #000000 !important;
        }
        .editor-content {
            outline: none;
            color: #000000 !important; 
            caret-color: #000000;
            overflow-wrap: break-word; 
            word-wrap: break-word;
        }
        .editor-content table { border-collapse: collapse; width: 100%; margin: 1em 0; border: 1px solid #ccc; }
        .editor-content td, .editor-content th { border: 1px solid #d1d5db; padding: 0.5rem; min-width: 50px; }
        .editor-content img { max-width: 100%; height: auto; cursor: default; }
        
        .page-break {
            border-bottom: 2px dashed #ccc;
            margin: 20px 0;
            position: relative;
            break-after: page;
        }
        .page-break::after {
            content: "Page Break";
            position: absolute; right: 0; top: -20px;
            color: #999; font-size: 10px; text-transform: uppercase;
        }
    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://aistudiocdn.com/react@^19.2.0",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "react/": "https://aistudiocdn.com/react@^19.2.0/",
    "lucide-react": "https://aistudiocdn.com/lucide-react@^0.555.0"
  }
}
</script>
<link rel="stylesheet" href="/index.css">
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const Icons = {
            FileText: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/></svg>,
            Home: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>,
            PlusCircle: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><path d="M8 12h8"/><path d="M12 8v8"/></svg>,
            FolderOpen: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m6 14 1.45-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.55 6a2 2 0 0 1-1.94 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2"/></svg>,
            FilePlus: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="12" y1="18" x2="12" y2="12"/><line x1="9" y1="15" x2="15" y2="15"/></svg>,
            Clock: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
            Trash2: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg>,
            ArrowLeft: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>,
            Save: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>,
            Bold: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M6 4h8a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z"/><path d="M6 12h9a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z"/></svg>,
            Italic: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="19" y1="4" x2="10" y2="4"/><line x1="14" y1="20" x2="5" y2="20"/><line x1="15" y1="4" x2="9" y2="20"/></svg>,
            Underline: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M6 3v7a6 6 0 0 0 6 6 6 6 0 0 0 6-6V3"/><line x1="4" y1="21" x2="20" y2="21"/></svg>,
            AlignLeft: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="17" y1="10" x2="3" y2="10"/><line x1="21" y1="6" x2="3" y2="6"/><line x1="21" y1="14" x2="3" y2="14"/><line x1="17" y1="18" x2="3" y2="18"/></svg>,
            AlignCenter: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="10" x2="6" y2="10"/><line x1="21" y1="6" x2="3" y2="6"/><line x1="21" y1="14" x2="3" y2="14"/><line x1="18" y1="18" x2="6" y2="18"/></svg>,
            AlignRight: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="21" y1="10" x2="7" y2="10"/><line x1="21" y1="6" x2="3" y2="6"/><line x1="21" y1="14" x2="3" y2="14"/><line x1="21" y1="18" x2="7" y2="18"/></svg>,
            List: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/></svg>,
            ListOrdered: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="10" y1="6" x2="21" y2="6"/><line x1="10" y1="12" x2="21" y2="12"/><line x1="10" y1="18" x2="21" y2="18"/><path d="M4 6h1v4"/><path d="M4 10h2"/><path d="M6 18H4c0-1 2-2 2-3s-1-1.5-2-1"/></svg>,
            Image: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>,
            Table: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 3h18v18H3zM21 9H3M21 15H3M12 3v18"/></svg>,
            Link: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>,
            Minus: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="5" y1="12" x2="19" y2="12"/></svg>,
            Printer: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect x="6" y="14" width="12" height="8"/></svg>,
            Download: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>,
            ZoomIn: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/><line x1="11" y1="8" x2="11" y2="14"/><line x1="8" y1="11" x2="14" y2="11"/></svg>,
            ZoomOut: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/><line x1="8" y1="11" x2="14" y2="11"/></svg>,
            CheckSquare: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="9 11 12 14 22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></svg>,
            Layout: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><line x1="3" y1="9" x2="21" y2="9"/><line x1="9" y1="21" x2="9" y2="9"/></svg>,
            Clipboard: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><rect x="8" y="2" width="8" height="4" rx="1" ry="1"/></svg>,
            Copy: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>,
            Scissors: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="6" cy="6" r="3"/><circle cx="6" cy="18" r="3"/><line x1="20" y1="4" x2="8.12" y2="15.88"/><line x1="14.47" y1="14.48" x2="20" y2="20"/><line x1="8.12" y1="8.12" x2="12" y2="12"/></svg>,
            HardDrive: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="22" y1="12" x2="2" y2="12"/><path d="M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z"/><line x1="6" y1="16" x2="6.01" y2="16"/><line x1="10" y1="16" x2="10.01" y2="16"/></svg>,
            EyeOff: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9.88 9.88a3 3 0 1 0 4.24 4.24"/><path d="M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68"/><path d="M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7c.44 0 .87-.03 1.28-.09"/><line x1="2" y1="2" x2="22" y2="22"/></svg>,
            Eye: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></svg>,
            Stamp: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M5 22h14"/><path d="M19.27 13.73A2.665 2.665 0 0 0 21 10.8V4a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v6.8a2.665 2.665 0 0 0 1.73 2.93"/><path d="M21 14a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v5a2 2 0 0 0 2 2h4a2 2 0 0 0 2-2z"/></svg>
        };

        const TEMPLATES = [
            { id: 'blank', name: 'Blank Document', category: 'General', content: '<p><br/></p>' },
            { id: 'resume', name: 'Modern Resume', category: 'Personal', content: `<h1 style="color:#2563eb">Your Name</h1><p>Address | Phone | Email</p><hr/><h3>Experience</h3><p>Job Title - Company</p>` },
            { id: 'invoice', name: 'Simple Invoice', category: 'Business', content: `<h1>INVOICE</h1><p>Date: 2024-01-01</p><table style="width:100%"><tr><th>Item</th><th>Cost</th></tr><tr><td>Service</td><td>$100</td></tr></table>` },
            { id: 'meeting', name: 'Meeting Notes', category: 'Business', content: `<h1>Meeting Minutes</h1><p>Date:</p><h3>Attendees</h3><ul><li>Person 1</li></ul><h3>Action Items</h3><ul><li>[ ] Task 1</li></ul>` }
        ];
        
        const FONTS = [
            'Inter', 'Arial', 'Verdana', 'Helvetica', 'Tahoma', 'Trebuchet MS', 'Times New Roman', 
            'Georgia', 'Garamond', 'Courier New', 'Brush Script MT', 
            'Roboto', 'Open Sans', 'Lato', 'Montserrat', 'Oswald', 'Source Sans Pro'
        ];
        const FONT_SIZES = ['10', '11', '12', '14', '16', '18', '24', '30', '36', '48', '60', '72'];

        const isRestrictedEnvironment = () => { try { return window.self !== window.top; } catch (e) { return true; } };

        const saveToLocalSystem = async (content, handle, type = 'html') => {
             if (type === 'docx') {
                 const fullHtml = `<!DOCTYPE html><html><head><style>body{font-family:Arial;}</style></head><body>${content}<script type="module" src="/index.tsx"></script>
</body></html>`;
                 if (window.htmlDocx) {
                    const converted = window.htmlDocx.asBlob(fullHtml);
                    window.saveAs(converted, 'document.docx');
                 }
             } else {
                 const blob = new Blob([content], {type: "text/html;charset=utf-8"});
                 window.saveAs(blob, "document.html");
             }
             return null;
        };

        const openFromLocalSystem = async () => {
             return new Promise((resolve) => {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.docx,.html,.htm,.txt,.md';
                input.onchange = async (e) => {
                  const file = e.target.files[0];
                  if (file) {
                    let content = '';
                    if (file.name.endsWith('.docx')) {
                         const arrayBuffer = await file.arrayBuffer();
                         if (window.mammoth) {
                            const result = await window.mammoth.convertToHtml({ arrayBuffer: arrayBuffer });
                            content = result.value;
                         }
                    } else {
                         content = await file.text();
                    }
                    resolve({ content, handle: null, name: file.name });
                  } else {
                    resolve(null);
                  }
                };
                input.click();
              });
        };

        // --- COMPONENTS ---

        // 1. DASHBOARD
        const Dashboard = ({ onSelectTemplate, recentFiles, onOpenRecent, onClearHistory, onOpenSystem }) => {
            const [activeSection, setActiveSection] = useState('Home');

            const NavBtn = ({ icon: IconComp, label, active, onClick }) => (
                <button 
                    onClick={onClick} 
                    className={`w-full flex items-center space-x-3 px-4 py-3 rounded-xl font-medium text-sm transition-all duration-200 ease-in-out active:scale-95 ${active ? 'bg-blue-100 text-blue-700 shadow-sm' : 'text-gray-600 hover:bg-gray-100'}`}
                >
                    <IconComp className="w-5 h-5" />
                    <span>{label}</span>
                </button>
            );

            return (
                <div className="flex h-screen bg-gray-50/50 font-sans text-gray-800 animate-fade-in">
                    <div className="w-64 bg-white border-r border-gray-100 flex flex-col p-6 shadow-[4px_0_24px_-12px_rgba(0,0,0,0.05)] z-10">
                        <div className="flex items-center space-x-2 mb-10 px-2">
                            <Icons.FileText className="text-blue-600 w-7 h-7" />
                            <span className="text-2xl font-bold logo-shimmer tracking-tight">OneDocs</span>
                        </div>
                        <div className="space-y-2 flex-1">
                            <NavBtn icon={Icons.Home} label="Home" active={activeSection === 'Home'} onClick={() => setActiveSection('Home')} />
                            <NavBtn icon={Icons.PlusCircle} label="New" active={activeSection === 'New'} onClick={() => setActiveSection('New')} />
                            <NavBtn icon={Icons.FolderOpen} label="Open" active={activeSection === 'Open'} onClick={() => setActiveSection('Open')} />
                        </div>
                        <div className="mt-auto pt-6 border-t border-gray-100 text-xs text-gray-400 px-2">OneDocs v2.0</div>
                    </div>

                    <div className="flex-1 overflow-auto p-10 bg-[#f8fafc]">
                        <div className="max-w-6xl mx-auto space-y-10">
                            
                            {activeSection === 'Open' && (
                                <section className="animate-slide-up">
                                     <h2 className="text-2xl font-bold mb-6 text-gray-800 tracking-tight">Open a document</h2>
                                     <button 
                                        onClick={onOpenSystem}
                                        className="flex items-center justify-center space-x-4 w-full max-w-lg h-40 bg-white border-2 border-dashed border-gray-300 rounded-2xl hover:border-blue-500 hover:bg-blue-50/50 hover:shadow-lg transition-all duration-300 group active:scale-[0.98]"
                                     >
                                        <div className="p-4 bg-blue-50 rounded-full group-hover:bg-blue-100 transition-colors">
                                            <Icons.HardDrive className="w-8 h-8 text-blue-500"/>
                                        </div>
                                        <div className="text-left">
                                            <div className="font-bold text-lg text-gray-700 group-hover:text-blue-700">Browse this computer</div>
                                            <div className="text-sm text-gray-400">Support for .docx, .html, .txt</div>
                                        </div>
                                     </button>
                                </section>
                            )}

                            {(activeSection === 'Home' || activeSection === 'New') && (
                                <section className="animate-slide-up">
                                    <h2 className="text-2xl font-bold mb-6 text-gray-800 tracking-tight">Start a new document</h2>
                                    <div className="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-6">
                                        {TEMPLATES.map((tpl, i) => (
                                            <button 
                                                key={tpl.id} 
                                                onClick={() => onSelectTemplate(tpl)} 
                                                className="group text-left transition-all duration-300 hover:-translate-y-1 active:scale-95"
                                                style={{ animationDelay: `${i * 0.05}s` }}
                                            >
                                                <div className="aspect-[3/4] bg-white border border-gray-100 rounded-xl shadow-sm hover:shadow-xl hover:border-blue-200 transition-all flex items-center justify-center mb-4 relative overflow-hidden">
                                                    <div className="absolute inset-0 bg-gradient-to-tr from-gray-50 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"></div>
                                                    <Icons.FilePlus className="text-gray-300 group-hover:text-blue-500 w-10 h-10 transition-colors relative z-10" />
                                                </div>
                                                <div className="font-semibold text-sm text-gray-800 group-hover:text-blue-600 transition-colors px-1">{tpl.name}</div>
                                                <div className="text-xs text-gray-400 px-1">{tpl.category}</div>
                                            </button>
                                        ))}
                                    </div>
                                </section>
                            )}

                            {(activeSection === 'Home') && (
                                <section className="animate-slide-up" style={{ animationDelay: '0.2s' }}>
                                    <div className="flex items-center justify-between mb-6">
                                        <h2 className="text-2xl font-bold text-gray-800 tracking-tight">Recent documents</h2>
                                        {recentFiles.length > 0 && <button onClick={onClearHistory} className="text-xs font-medium text-red-500 hover:text-red-600 hover:bg-red-50 px-3 py-1.5 rounded-lg transition-colors">Clear History</button>}
                                    </div>
                                    <div className="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden min-h-[300px]">
                                        {recentFiles.length === 0 ? (
                                            <div className="flex flex-col items-center justify-center h-80 text-gray-400 bg-gray-50/30">
                                                <div className="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4">
                                                    <Icons.Clock className="w-8 h-8 text-gray-300" />
                                                </div>
                                                <p className="font-medium">No recent documents</p>
                                                <p className="text-xs mt-1">Your saved files will appear here</p>
                                            </div>
                                        ) : (
                                            <table className="w-full text-left">
                                                <thead className="bg-gray-50/80 text-xs font-semibold text-gray-500 uppercase border-b border-gray-100">
                                                    <tr><th className="px-8 py-4">Name</th><th className="px-8 py-4">Last Modified</th><th className="px-8 py-4 text-right">Actions</th></tr>
                                                </thead>
                                                <tbody className="divide-y divide-gray-50">
                                                    {recentFiles.map(file => (
                                                        <tr key={file.id} className="hover:bg-blue-50/50 transition-colors cursor-pointer group" onClick={() => onOpenRecent(file)}>
                                                            <td className="px-8 py-4 font-medium flex items-center text-gray-700">
                                                                <div className="w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center text-blue-600 mr-3 group-hover:scale-110 transition-transform">
                                                                    <Icons.FileText className="w-4 h-4"/> 
                                                                </div>
                                                                <span className="group-hover:text-blue-700 transition-colors">{file.title}</span>
                                                            </td>
                                                            <td className="px-8 py-4 text-sm text-gray-500">{new Date(file.lastModified).toLocaleDateString()}</td>
                                                            <td className="px-8 py-4 text-right">
                                                                <button onClick={(e) => { e.stopPropagation(); onClearHistory(file.id); }} className="text-gray-300 hover:text-red-500 hover:bg-red-50 p-2 rounded-full transition-all active:scale-90">
                                                                    <Icons.Trash2 className="w-4 h-4" />
                                                                </button>
                                                            </td>
                                                        </tr>
                                                    ))}
                                                </tbody>
                                            </table>
                                        )}
                                    </div>
                                </section>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        // 2. EDITOR
        const Editor = ({ content, config, zoom, onInput, contentRef }) => {
            const editorDivRef = useRef(null);

            useEffect(() => {
                if (editorDivRef.current && editorDivRef.current.innerHTML !== content) {
                     // Initial Load logic
                     if (!content || content === '' || content === '<p><br/></p>' || content === editorDivRef.current.innerHTML) {
                         if (editorDivRef.current.innerHTML === '') editorDivRef.current.innerHTML = content;
                     } else {
                         // Force update if content changed externally (like file load)
                         // This is safe because key={} prop in App remounts this component on file load
                         editorDivRef.current.innerHTML = content;
                     }
                }
            }, []); 

            useEffect(() => { if (contentRef) contentRef.current = editorDivRef.current; }, [contentRef]);

            const widthStr = config.orientation === 'portrait' ? '8.5in' : '11in';
            const heightStr = config.orientation === 'portrait' ? '11in' : '8.5in';

            return (
                <div className="flex-1 overflow-auto bg-[#f3f4f6] p-8 flex justify-center scrollbar-thin animate-fade-in" onClick={(e) => { if(e.target === e.currentTarget) editorDivRef.current?.focus(); }}>
                    <div 
                        style={{ 
                            width: widthStr, 
                            minHeight: heightStr,
                            transform: `scale(${zoom})`,
                            transformOrigin: 'top center',
                            marginBottom: '4rem'
                        }} 
                        className="relative flex flex-col transition-transform duration-200 ease-out"
                    >
                        <div 
                            className="bg-white shadow-xl min-h-full h-full relative editor-page box-border rounded-sm"
                            style={{ padding: config.margins }}
                        >
                             {/* Watermark */}
                            {config.watermarkText && (
                                <div className="absolute inset-0 flex items-center justify-center pointer-events-none overflow-hidden select-none z-0">
                                    <span 
                                        className="text-gray-200 font-bold opacity-50 transform -rotate-45" 
                                        style={{ fontSize: '120px', whiteSpace: 'nowrap' }}
                                    >
                                        {config.watermarkText}
                                    </span>
                                </div>
                            )}

                            <div 
                                ref={editorDivRef}
                                className="editor-content w-full h-full outline-none z-10 relative"
                                contentEditable={true}
                                spellCheck={config.spellCheck}
                                onInput={onInput}
                            />
                        </div>
                    </div>
                </div>
            );
        };

        // 3. TOOLBAR (Ribbon)
        const Toolbar = ({ activeTab, setActiveTab, exec, config, setConfig, onAction, zoomIn, zoomOut }) => {
            const tabs = ['File', 'Home', 'Insert', 'Layout', 'Review', 'View'];
            
            const RibBtn = ({ icon: Icon, label, onClick, active, alert }) => (
                <button 
                    onClick={onClick} 
                    className={`flex flex-col items-center justify-center px-3 py-1.5 h-full rounded-lg min-w-[3.5rem] transition-all duration-200 ease-in-out hover:scale-105 active:scale-95 ${active ? 'bg-blue-50 text-blue-600 shadow-inner' : 'hover:bg-gray-100 text-gray-700'}`}
                >
                    <Icon className={`w-5 h-5 mb-1 ${alert?'animate-pulse text-red-500':''}`} />
                    <span className="text-[10px] font-semibold leading-tight">{label}</span>
                </button>
            );

            const SmallBtn = ({ icon: Icon, onClick, title }) => (
                <button onClick={onClick} title={title} className="p-1.5 hover:bg-gray-100 rounded-md text-gray-600 hover:text-blue-600 transition-colors active:scale-90"><Icon className="w-4 h-4"/></button>
            );

            return (
                <div className="flex flex-col bg-white border-b border-gray-200 shadow-[0_2px_8px_-4px_rgba(0,0,0,0.1)] z-30 select-none">
                    <div className="flex px-4 pt-2 bg-gray-50/80 border-b border-gray-200 space-x-1 backdrop-blur-sm">
                        <div className="font-extrabold text-lg bg-gradient-to-r from-blue-600 to-blue-500 bg-clip-text text-transparent mr-6 py-1 px-2 tracking-tighter">OneDocs</div>
                        {tabs.map(t => (
                            <button 
                                key={t} 
                                onClick={() => setActiveTab(t)} 
                                className={`px-5 py-1.5 text-xs font-semibold rounded-t-lg border-t-2 border-x transition-colors duration-150 ${activeTab === t ? 'bg-white text-blue-600 border-blue-500 border-b-white shadow-[0_-2px_4px_rgba(0,0,0,0.02)]' : 'border-transparent text-gray-500 hover:bg-gray-100 hover:text-gray-700'}`}
                            >
                                {t}
                            </button>
                        ))}
                    </div>
                    <div className="h-24 px-4 py-2 flex items-center space-x-2 overflow-x-auto whitespace-nowrap scrollbar-thin bg-white">
                        {activeTab === 'File' && (
                            <>
                                <RibBtn icon={Icons.FileText} label="New" onClick={() => onAction('new')} />
                                <RibBtn icon={Icons.FolderOpen} label="Open" onClick={() => onAction('open')} />
                                <RibBtn icon={Icons.Save} label="Save" onClick={() => onAction('save')} />
                                <div className="w-px h-10 bg-gray-100 mx-2"></div>
                                <RibBtn icon={Icons.Printer} label="Print" onClick={() => window.print()} />
                                <RibBtn icon={Icons.Download} label="Export" onClick={() => onAction('save')} />
                            </>
                        )}
                        {activeTab === 'Home' && (
                            <>
                                <div className="flex space-x-1">
                                    <SmallBtn icon={Icons.Clipboard} onClick={() => exec('paste')} title="Paste"/>
                                    <SmallBtn icon={Icons.Copy} onClick={() => exec('copy')} title="Copy"/>
                                    <SmallBtn icon={Icons.Scissors} onClick={() => exec('cut')} title="Cut"/>
                                </div>
                                <div className="w-px h-10 bg-gray-100 mx-2"></div>
                                <div className="flex flex-col space-y-1.5">
                                    <select onChange={(e) => exec('fontName', e.target.value)} className="h-6 w-32 text-xs border border-gray-300 rounded px-1 outline-none focus:border-blue-500 bg-white text-gray-900 transition-colors"><option>Arial</option>{FONTS.map(f => <option key={f} value={f}>{f}</option>)}</select>
                                    <select onChange={(e) => exec('fontSize', '4')} className="h-6 w-16 text-xs border border-gray-300 rounded px-1 outline-none focus:border-blue-500 bg-white text-gray-900 transition-colors"><option>11</option><option>12</option><option>14</option><option>16</option><option>18</option><option>24</option><option>36</option></select>
                                </div>
                                <div className="flex space-x-0.5 items-center mx-1">
                                    <SmallBtn icon={Icons.Bold} onClick={() => exec('bold')} title="Bold"/>
                                    <SmallBtn icon={Icons.Italic} onClick={() => exec('italic')} title="Italic"/>
                                    <SmallBtn icon={Icons.Underline} onClick={() => exec('underline')} title="Underline"/>
                                    <input type="color" className="w-6 h-6 border-0 p-0 ml-1 rounded cursor-pointer hover:scale-110 transition-transform bg-white" onChange={(e) => exec('foreColor', e.target.value)}/>
                                </div>
                                <div className="w-px h-10 bg-gray-100 mx-2"></div>
                                <div className="flex space-x-0.5">
                                    <SmallBtn icon={Icons.AlignLeft} onClick={() => exec('justifyLeft')} title="Left"/>
                                    <SmallBtn icon={Icons.AlignCenter} onClick={() => exec('justifyCenter')} title="Center"/>
                                    <SmallBtn icon={Icons.AlignRight} onClick={() => exec('justifyRight')} title="Right"/>
                                </div>
                            </>
                        )}
                         {activeTab === 'Insert' && (
                            <>
                                <RibBtn icon={Icons.Image} label="Picture" onClick={() => onAction('insertImage')} />
                                <RibBtn icon={Icons.Table} label="Table" onClick={() => onAction('insertTable')} />
                                <RibBtn icon={Icons.Link} label="Link" onClick={() => { const u=prompt('URL:'); if(u) exec('createLink',u); }} />
                                <RibBtn icon={Icons.Minus} label="Line" onClick={() => exec('insertHorizontalRule')} />
                            </>
                        )}
                        {activeTab === 'Layout' && (
                             <div className="flex space-x-4 px-2">
                                <div className="flex flex-col text-xs"><span className="mb-1 text-gray-500 font-medium">Margins</span>
                                    <select value={config.margins} onChange={(e) => setConfig({...config, margins: e.target.value})} className="border border-gray-300 rounded p-1 bg-white text-gray-900 outline-none focus:border-blue-500"><option value="1in">Normal</option><option value="0.5in">Narrow</option><option value="2in">Wide</option></select>
                                </div>
                                <div className="flex flex-col text-xs"><span className="mb-1 text-gray-500 font-medium">Orientation</span>
                                    <select value={config.orientation} onChange={(e) => setConfig({...config, orientation: e.target.value})} className="border border-gray-300 rounded p-1 bg-white text-gray-900 outline-none focus:border-blue-500"><option value="portrait">Portrait</option><option value="landscape">Landscape</option></select>
                                </div>
                                 <RibBtn icon={Icons.Stamp} label="Watermark" onClick={() => {
                                     const text = prompt("Enter Watermark Text (leave empty to remove):", config.watermarkText);
                                     setConfig({...config, watermarkText: text || undefined});
                                 }} />
                             </div>
                        )}
                        {activeTab === 'Review' && (
                            <RibBtn icon={Icons.CheckSquare} label="Spell Check" active={config.spellCheck} onClick={() => setConfig({...config, spellCheck: !config.spellCheck})} />
                        )}
                        {activeTab === 'View' && (
                            <>
                                <RibBtn icon={Icons.ZoomIn} label="Zoom In" onClick={zoomIn} />
                                <RibBtn icon={Icons.ZoomOut} label="Zoom Out" onClick={zoomOut} />
                                <RibBtn icon={Icons.EyeOff} label="Focus Mode" onClick={() => setConfig({...config, isFocusMode: true})} />
                            </>
                        )}
                    </div>
                </div>
            );
        };

        // 4. MAIN APP
        const App = () => {
            const [view, setView] = useState('dashboard');
            const [activeTab, setActiveTab] = useState('Home');
            const [docName, setDocName] = useState('Untitled Document');
            const [content, setContent] = useState(TEMPLATES[0].content);
            const contentRef = useRef(null);
            const [recentFiles, setRecentFiles] = useState([]);
            const [zoom, setZoom] = useState(1);
            const [wordCount, setWordCount] = useState(0);
            const [config, setConfig] = useState({
                fontFamily: 'Arial', fontSize: '16', margins: '1in',
                orientation: 'portrait', size: 'Letter', spellCheck: true,
                theme: 'light', showStatusBar: true, isFocusMode: false, watermarkText: undefined
            });
            // Key to force remount Editor when loading a new file
            const [docKey, setDocKey] = useState(0);

            useEffect(() => {
                const loaded = localStorage.getItem('onedocs_recents');
                if (loaded) setRecentFiles(JSON.parse(loaded));
            }, []);

            const updateRecents = (title, text) => {
                const newF = { id: Date.now(), title, lastModified: Date.now(), content: text };
                const list = [newF, ...recentFiles.filter(f => f.title !== title)].slice(0, 10);
                setRecentFiles(list);
                localStorage.setItem('onedocs_recents', JSON.stringify(list));
            };

            const exec = (cmd, val) => {
                document.execCommand(cmd, false, val);
                contentRef.current?.focus();
            };

            const handleFileUpload = (e) => {
                const file = e.target.files[0];
                if (!file) return;

                console.log("File selected:", file.name);

                if (file.name.endsWith('.docx')) {
                     const reader = new FileReader();
                     reader.onload = async (event) => {
                        const arrayBuffer = event.target.result;
                        if (window.mammoth) {
                            try {
                                const result = await window.mammoth.convertToHtml({ arrayBuffer: arrayBuffer });
                                console.log("Mammoth Result:", result);
                                setContent(result.value); 
                                setDocName(file.name); 
                                updateRecents(file.name, result.value);
                                setDocKey(prev => prev + 1); // Force Editor remount
                                setView('editor');
                            } catch (err) {
                                console.error("Mammoth Error:", err);
                                alert("Failed to open DOCX file.");
                            }
                        } else {
                            alert("Mammoth library not loaded.");
                        }
                     };
                     reader.readAsArrayBuffer(file);
                } else {
                     // Text/HTML fallback
                     const reader = new FileReader();
                     reader.onload = (event) => {
                        const text = event.target.result;
                        setContent(text);
                        setDocName(file.name);
                        updateRecents(file.name, text);
                        setDocKey(prev => prev + 1);
                        setView('editor');
                     };
                     reader.readAsText(file);
                }
            };

            const handleAction = async (action) => {
                if (action === 'new') { if(confirm('Discard changes?')) { setContent(TEMPLATES[0].content); setDocName('Untitled'); setDocKey(p=>p+1); } }
                else if (action === 'save') { 
                    const fullHtml = `<!DOCTYPE html><html><head><style>body{font-family:Arial;}</style></head><body>${contentRef.current.innerHTML}</body></html>`;
                    if (window.htmlDocx) {
                        const converted = window.htmlDocx.asBlob(fullHtml);
                        window.saveAs(converted, `${docName}.docx`);
                        updateRecents(docName, contentRef.current.innerHTML);
                    }
                }
                else if (action === 'open') { 
                     const input = document.createElement('input'); input.type = 'file'; input.accept = '.docx,.html,.htm,.txt';
                     input.onchange = handleFileUpload;
                     input.click();
                }
                else if (action === 'insertImage') {
                    const input = document.createElement('input'); input.type='file'; input.accept='image/*';
                    input.onchange = (e) => {
                        const file = e.target.files[0];
                        if(file) {
                            const r = new FileReader();
                            r.onload = (re) => exec('insertHTML', `<img src="${re.target.result}" style="max-width:100%"/>`);
                            r.readAsDataURL(file);
                        }
                    };
                    input.click();
                }
                else if (action === 'insertTable') {
                    exec('insertHTML', '<table style="width:100%; border:1px solid #ccc"><tr><td style="border:1px solid #ccc; padding:5px">Cell 1</td><td style="border:1px solid #ccc; padding:5px">Cell 2</td></tr></table>');
                }
            };

            const handleLiveStats = () => {
                if (contentRef.current) setWordCount(contentRef.current.innerText.trim().split(/\s+/).filter(w => w).length);
            };

            // OPEN SYSTEM HANDLER (Dashboard)
            const openSystem = () => {
                 const input = document.createElement('input'); input.type = 'file'; input.accept = '.docx,.html,.htm,.txt';
                 input.onchange = handleFileUpload;
                 input.click();
            };

            if (view === 'dashboard') {
                return (
                    <Dashboard 
                        onSelectTemplate={(tpl) => { setContent(tpl.content); setDocName(`New ${tpl.name}`); setDocKey(p=>p+1); setView('editor'); }}
                        recentFiles={recentFiles}
                        onOpenRecent={(f) => { setContent(f.content); setDocName(f.title); setDocKey(p=>p+1); setView('editor'); }}
                        onClearHistory={(id) => {
                             const list = id ? recentFiles.filter(f => f.id !== id) : [];
                             setRecentFiles(list);
                             localStorage.setItem('onedocs_recents', JSON.stringify(list));
                        }}
                        onOpenSystem={openSystem}
                    />
                );
            }

            return (
                <div className="flex flex-col h-screen bg-gray-100 font-sans">
                    {!config.isFocusMode && (
                        <div className="h-10 bg-gradient-to-r from-blue-700 to-blue-600 text-white flex items-center justify-between px-4 z-40 shadow-md shrink-0">
                            <div className="flex items-center space-x-4">
                                <button onClick={() => setView('dashboard')} className="flex items-center space-x-1 hover:bg-white/10 px-3 py-1.5 rounded-md transition-colors active:scale-95 text-xs font-bold">
                                    <Icons.ArrowLeft className="w-4 h-4" /> <span>Home</span>
                                </button>
                                <div className="h-4 w-px bg-blue-400/50"></div>
                                <input value={docName} onChange={(e) => setDocName(e.target.value)} className="bg-transparent border-b border-transparent hover:border-blue-300 focus:border-white focus:outline-none text-sm font-medium px-1 placeholder-blue-200 transition-colors"/>
                            </div>
                        </div>
                    )}

                    {config.isFocusMode && (
                         <button 
                            onClick={() => setConfig({...config, isFocusMode: false})}
                            className="absolute top-4 right-4 z-50 bg-gray-800/50 hover:bg-gray-800 text-white p-2 rounded-full transition-colors"
                            title="Exit Focus Mode"
                        >
                            <Icons.EyeOff className="w-5 h-5" />
                        </button>
                    )}

                    <Toolbar 
                        activeTab={activeTab} setActiveTab={setActiveTab} exec={exec} config={config} setConfig={setConfig} 
                        onAction={handleAction} zoomIn={() => setZoom(z => Math.min(z+0.1, 2))} zoomOut={() => setZoom(z => Math.max(z-0.1, 0.5))}
                    />

                    <Editor key={docKey} content={content} onInput={handleLiveStats} contentRef={contentRef} config={config} zoom={zoom} />

                    {config.showStatusBar && !config.isFocusMode && (
                        <div className="bg-white border-t border-gray-200 h-7 flex items-center justify-between px-4 text-[10px] font-medium text-gray-500 select-none shrink-0 z-50">
                            <div className="flex space-x-6"><span>Page 1 of 1</span><span>{wordCount} words</span></div>
                            <div className="flex space-x-6"><span className="uppercase">{config.orientation}</span><span>{(zoom * 100).toFixed(0)}%</span></div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
